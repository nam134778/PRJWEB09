<!DOCTYPE html>
<html>
    <head>
        <title>PRJWEB | Main Page</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Assistant:400,700" rel="stylesheet"><link rel="stylesheet" href="./list.css">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>




    </head>

    <body>
        <!-- <div style="align-items: center; justify-content:center; margin-left: 300px;">
            <h1>
                BẢNG LƯƠNG THÁNG 3
              </h1>
              
              <p id="demo"></p>
              <p id="demo2"></p>
              <p id="demo3"></p>
              <table class="table table-striped" id="ex-table" style="width: 500px;">
                <thead>
                    <tr id="tr">
                        <th>Email</th>
                        <th>Salary</th> 
                        <th>Hours</th>
                      </tr>
                    </thead>
                    </table>
                    <tbody>
                      </tbody>
              
               </table> 

            <textarea id="feedback"    name="feedback"    placeholder="Feedback"></textarea>
            <input    type="submit"    id="send"          name="send"     value="Gửi">


        </div> -->
        <div>
            <div class='container-fluid header'>
                <div class='row' style="justify-content: center; align-items: center; height: 60px;">
                    <!-- <span><BsGithub size={50} style={{paddingTop:"2rem"}}/></span> -->
                    <span><h1 style="margin-top: 40px; font-weight: 700;">Công cụ quản lý công ty PRJWEB</h1></span>
                </div>
                <div class='row'>
                    <!-- <span><BsGithub size={50} style={{paddingTop:"2rem"}}/></span> -->
                    <span><a href="./index.html" class='btn-login' id='signin' type="submit" name="signin" style="margin-top: -20px; background-color: none; border: 2px; margin-left: 2300px;">Đăng xuất</a></span>
                </div>
            </div>
            <p style="margin-left: 40%; margin-top: 30px; font-size: 50px; font-weight: 700;">BẢNG LƯƠNG THÁNG 3</p>
            <!-- <div>
                <row>
                    <col><span><p style="margin-left: 1000px; font-size: 25px; font-weight: 700;">Email: </p><input type="text" id="email" name="email" placeholder="Email" style="margin-left: 1000px; margin-top: -10px;"/></span></br>
                    <span><p style="margin-left: 1000px; font-size: 25px; font-weight: 700;">Giờ làm: </p><input type="text" id="hours" name="hours" placeholder="Giờ làm" style="margin-left: 1000px; margin-top: -10px;"/></span></br>
                    <span><p style="margin-left: 1000px; font-size: 25px; font-weight: 700;">Lương: </p><input type="text" id="salary" name="salary" placeholder="Lương" style="margin-left: 1000px; margin-top: -10px;"/></span></col>
                    <col><span><p style="margin-left: 1000px; font-size: 25px; font-weight: 700;">Email: </p><input type="text" id="email" name="email" placeholder="Email" style="margin-left: 1000px; margin-top: -10px;"/></span></br>
                    <span><p style="margin-left: 1000px; font-size: 25px; font-weight: 700;">Giờ làm: </p><input type="text" id="hours" name="hours" placeholder="Giờ làm" style="margin-left: 1000px; margin-top: -10px;"/></span></br>
                    <span><p style="margin-left: 1000px; font-size: 25px; font-weight: 700;">Lương: </p><input type="text" id="salary" name="salary" placeholder="Lương" style="margin-left: 1000px; margin-top: -10px;"/></span></col>
                </row>
            </div> -->
            <div class="row">
                <div class="column">
                    <span><p style="margin-left: 1000px; font-size: 25px; font-weight: 700;">Email: </p><input type="text" id="email" name="email" placeholder="Email" style="margin-left: 1000px; margin-top: -10px;"/></span></br>
                    <span><p style="margin-left: 1000px; font-size: 25px; font-weight: 700;">Giờ làm: </p><input type="text" id="hours" name="hours" placeholder="Giờ làm" style="margin-left: 1000px; margin-top: -10px;"/></span></br>
                    <span><p style="margin-left: 1000px; font-size: 25px; font-weight: 700;">Lương: </p><input type="text" id="salary" name="salary" placeholder="Lương" style="margin-left: 1000px; margin-top: -10px;"/></span>
                </div>
                <div class="column" style="margin-top: 30px;">
                    <span><button class="button-27" id="add" type="submit" style="width: 200px; margin-top: 25px;">Thêm</button></span></br>
                    <span><button class="button-27" role="button" id="delete2" type="submit" style="width: 200px; margin-top: 20px;">Xoá</button></span></br>
                    <span><button class="button-27" role="button" id="update2" type="submit" style="width: 200px; margin-top: 20px;">Sửa</button></span></br>

                </div>
              </div>
            <div style="justify-content: center">
                <table class="styled-table" id="ex-table" style="width: 500px; margin-left: 32%; margin-top: 50px;">
                    <thead >
                        <tr id="tr" >
                            <th>Email</th>
                            <th>Salary</th> 
                            <th>Hours</th>
                          </tr>
                        </thead>
                        </table>
                        <tbody>
                          </tbody>
                   </table> 
            </div>
              </div>
    </body>
    <!-- <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script> -->
    <script type="module">
        // import "https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js";
        // import "https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js";

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
        import { getDatabase, ref, update } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";

        import { getAuth, signInWithEmailAndPassword} from "https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js";

        import { getFirestore, doc, setDoc, deleteDoc, addDoc, getDoc, getDocs, updateDoc, onSnapshot, collection, query, where } from 'https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js';


           
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyAgXRktPnpQ_tToW7tXQdPlxSXRf9_VK88",
          authDomain: "prjweb-d2e8d.firebaseapp.com",
          databaseURL: "https://prjweb-d2e8d-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "prjweb-d2e8d",
          storageBucket: "prjweb-d2e8d.appspot.com",
          messagingSenderId: "722705639877",
          appId: "1:722705639877:web:4cfedddcf5ec0e82fb83ac",
          measurementId: "G-K50Z8KJNX7"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();
        const db = getFirestore(app);


        const email = localStorage.getItem("email");
        console.log(email);

//         const querySnapshot2 = await getDocs(collection(db, "Bang_luong"));
//         var content = '';
// querySnapshot2.forEach((doc) => {
//                 var val = doc.data();
//                 // content +='<tr>';
//                 content +='<tr>';
//                 content += `<td>` + val.Email + '</td>';
//                 content += `<td>` + val.luong + '</td>';
//                 content += `<td>` + val.hours + '</td>';

//                 content += '</tr>';
//   // doc.data() is never undefined for query doc snapshots
//   console.log(doc.id, " => ", doc.data());
// });
// $('#ex-table').append(content);
    async function GetDoc() {
        const querySnapshot2 = await getDocs(collection(db, "Bang_luong"));
        var content = '';
querySnapshot2.forEach((doc) => {
                var val = doc.data();
                // content +='<tr>';
                content +='<tr>';
                content += `<td>` + val.Email + '</td>';
                content += `<td>` + val.luong + '</td>';
                content += `<td>` + val.hours + '</td>';

                content += '</tr>';
  // doc.data() is never undefined for query doc snapshots
  console.log(doc.id, " => ", doc.data());
});
$('#ex-table').append(content);
    }

    GetDoc();

    // async function UpdateDoc() {
    //     var feedback = document.getElementById("feedback").value;
    //     const q = query(collection(db, "feedback"), where("Email", "==", email));
    //     const querySnapshot = await getDocs(q);


    //     querySnapshot.forEach((docref) => {
    //     // doc.data() is never undefined for query doc snapshots
    //     // console.log(doc.id, " => ", doc.data());
    //     const docRef = doc(db, 'feedback', docref.id);
    //     setDoc(docRef, {Content: feedback},{merge:true})
    //     });

    // }

//   send.addEventListener('click', UpdateDoc);


  add.addEventListener('click', (e) => {
            var email       = document.getElementById('email').value;
            var hours    = document.getElementById('hours').value;
            var salary    = document.getElementById('salary').value;
                try {

                const docRef = addDoc(collection(db, "Bang_luong"), {
                        Email: email,
                        luong: salary,
                        hours: hours,

                    });
                    console.log("Document written with ID: ", docRef.id);
                    alert('add successfully');
                    var tableHeaderRowCount = 1;
                    var table = document.getElementById('ex-table');
                    var rowCount = table.rows.length;
                    for (var i = tableHeaderRowCount; i < rowCount; i++) {
                        table.deleteRow(tableHeaderRowCount);
                    }
                    GetDoc();
                    // location.reload();
                    } catch (e) {
                    console.error("Error adding document: ", e);
                    }
                    

// window.location.reload()
                // ...
        })

        async function DeleteDoc () {
        var email       = document.getElementById('email').value;
        var hours    = document.getElementById('hours').value;
        var salary    = document.getElementById('salary').value;
        if (email != null) {
            const q = query(collection(db, "Bang_luong"), where("Email", "==", email));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((docref) => {

        const docRef = doc(db, 'Bang_luong', docref.id);
        deleteDoc(docRef);
        });
        } else {
            if (salary != null) {
                const q = query(collection(db, "Bang_luong"), where("luong", "==", salary));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((docref) => {

        const docRef = doc(db, 'Bang_luong', docref.id);
        deleteDoc(docRef);
        });
            } else {
                const q = query(collection(db, "Bang_luong"), where("hours", "==", hours));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((docref) => {

        const docRef = doc(db, 'Bang_luong', docref.id);
        deleteDoc(docRef);
        });
            }
        }
        alert('delete successfully');
        var tableHeaderRowCount = 1;
        var table = document.getElementById('ex-table');
        var rowCount = table.rows.length;
        for (var i = tableHeaderRowCount; i < rowCount; i++) {
            table.deleteRow(tableHeaderRowCount);
        }
        GetDoc();
    }
    delete2.addEventListener('click', DeleteDoc);

    async function UpdateDoc() {
        var email    = document.getElementById('email').value;
        var hours    = document.getElementById('hours').value;
        var salary    = document.getElementById('salary').value;
        const q = query(collection(db, "Bang_luong"), where("Email", "==", email));
        const querySnapshot = await getDocs(q);


        querySnapshot.forEach((docref) => {
        const docRef = doc(db, 'Bang_luong', docref.id);
        setDoc(docRef, {hours: hours, luong: salary},{merge:true})
        });
        alert('update successfully');
        var tableHeaderRowCount = 1;
        var table = document.getElementById('ex-table');
        var rowCount = table.rows.length;
        for (var i = tableHeaderRowCount; i < rowCount; i++) {
            table.deleteRow(tableHeaderRowCount);
        }
        GetDoc();

    }
    update2.addEventListener('click', UpdateDoc);
      </script>

</html>